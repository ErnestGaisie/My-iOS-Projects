//
//  StatusDataService.swift
//  MalwareApp
//
//  Created by Ernest Gaisie on 10/02/2025.
//

import Foundation
import Combine

class StatusDataService {
    var allStatusRespone: GetStatusAPIResponse?
    @Published var allStatuses: [StatusModel] = []
    @Published var errorMessage: String? = nil

    var statusSubscription: AnyCancellable?
    
    init() {
        getStatuses()
    }
    
    func getStatuses(){
        guard let url = URL(string: API.recentURLs) else {
            errorMessage = "Invalid URL"
            return
        }
        
        statusSubscription = NetworkingManager.download(url: url)
            .decode(type: GetStatusAPIResponse.self, decoder: JSONDecoder())
            .sink(receiveCompletion: NetworkingManager.handleCompletion, receiveValue: { [weak self] returnedStatuses in
                self?.allStatuses = returnedStatuses.urls ?? []
                self?.statusSubscription?.cancel()
            })
    }

}
