//
//  StatusRowView.swift
//  MalwareApp
//
//  Created by Ernest Gaisie on 10/02/2025.
//

import SwiftUI

struct StatusRowView: View {
    let status: StatusModel
    @State private var isExpanded: Bool = false

    var body: some View {
        HStack(spacing: 0){
           
            // status
            statusChip
            
            //information
            statusInfo
            
            Spacer()
            
            //chevron
            Image(systemName: isExpanded ? "chevron.up" : "chevron.down")
                                .foregroundColor(.white)
            
        }
        .onTapGesture {
            withAnimation {
                isExpanded.toggle()
            }
        }
        
    }
}

#Preview(traits: .sizeThatFitsLayout) {
    StatusRowView(
        status: StatusModel(id: 1, urlhaus_reference: "https://urlhaus.abuse.ch/url/3435745/", url_status: URLStatus.online, threat: "malware_download")
    )
}

extension StatusRowView {
    private var statusChip: some View {
        Circle()
        .fill(status.url_status == URLStatus.online ? Color.theme.yellow :   Color.theme.red)
        .frame(width: 20, height: 20)
        .padding(.trailing)
    }
    
    private var statusInfo: some View {
        VStack (alignment: .leading) {
            Text(status.formattedThreat ?? "")
                .bold()
                .foregroundColor(Color.theme.accent)
            
            Text(status.urlhaus_reference ?? "")
                .foregroundColor(
                    Color.theme.secondaryText
                )
                .lineLimit(isExpanded ? 2 : 1)
                .truncationMode(.tail)
              
        }
    }

}


